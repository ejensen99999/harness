# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  branches:
    include:
      - main
  paths:
    include:
      - image/*

variables:
  - group: dockerHub

pool:
  name: linux 

steps:

- task: Bash@3
  displayName: "Set Location"
  inputs:
    targetType: 'inline'
    script: |
      location=$(pwd)
      echo "##vso[task.setvariable variable=pwd;]$location"

- task: Bash@3
  inputs:
   targetType: 'inline'
   script:  echo "$(pwd)"

- task: PackerTool@0
  displayName: "Packer Load"
  inputs:
    version: 

- task: Packer@1
  displayName: "Packer Init"
  inputs:
    connectedServiceType: 'none'
    templatePath: 'image/linux/docker.pkr.hcl'
    command: 'init'

- task: Packer@1
  displayName: "Packer Build"
  inputs:
    connectedServiceType: 'none'
    templatePath: 'image/linux/docker.pkr.hcl'
    command: 'build'
    variables: |
      SOURCE_DIR=$(pwd)
      CONFIG=configs/custom-job-delegate.hd.json
      EMAIL=ejensen99999@comcast.net
      NAME=custom-job-delegate
      IMAGE_REGISTRY_PATH=ejensen99999
      LOGIN_USER=$(LOGIN_USER)
      LOGIN_PASS=$(LOGIN_PASS)
